{
	"info": {
		"_postman_id": "6554748b-8871-4e83-8c4d-7ab315f9894a",
		"name": "FIWARE XACML Rules",
		"description": "[![FIWARE Security](https://nexus.lab.fiware.org/repository/raw/public/badges/chapters/security.svg)](https://github.com/FIWARE/catalogue/blob/master/security/README.md)\n\nThis tutorial introduces an additional security generic enabler - **Authzforce**\nand adds fine grained control to the security rules generated by **Keyrock**.\nAccess to the entities created in the\n[previous tutorial](https://github.com/Fiware/tutorials.PEP-Proxy) is now\nconfigured and controlled using an XACML access control policy - this creates a\nflexible ruleset which can be uploaded and reinterpreted on the fly so complex\nbusiness rules can be created and changed according to current circumstances.\n\nThe tutorial discusses code showing how to integrate **Authzforce** within a web\napplication and demonstrates examples of **Authzforce** XACML Server-PDP\ninteractions. [cUrl](https://ec.haxx.se/) commands are used to show the\ninteractions between generic enablers.\n\nThe `docker-compose` files for this tutorial can be found on GitHub: \n\n![GitHub](https://fiware.github.io/tutorials.XACML-Access-Rules/icon/GitHub-Mark-32px.png) [FIWARE 405: Ruleset Based Permissions](https://github.com/Fiware/tutorials.XACML-Access-Rules)\n\n\n# Ruleset Based Permissions\n\n> \"Say: Come, I will rehearse what _Allah_ hath prohibited you from:\n>\n> -   Join not anything as equal with _Him_\n> -   Be good to your parents\n> -   Kill not your children on a plea of want - _We_ provide sustenance for you\n>     and for them\n> -   Come not nigh to shameful deeds. Whether open or secret\n> -   Take not life, which _Allah_ hath made sacred, except by way of justice\n>     and law\n>\n> thus doth _He_ command you, that ye may learn wisdom.\"\n>\n> — Quran 6.151, Sūrat al-Anʻām\n\n[Previous tutorials](https://github.com/Fiware/tutorials.Securing-Access) have\nintroduced a simple access control system based on authentication (level 1) or\nbasic authorization access to resources based on a role (level 2). These\npolicies are easy to create, but the rules within them are very black and white,\nrules cannot rely on one another, have exception clauses or offer access based\non time limits or attribute values. There is also no mechanism to resolve\ndifferent rules in the case of conflict.\n\nTo satisfy a complex access control scenario, an additional arbitration\nmicroservice is required, which is able to come to a judgement on each\nPermit/Deny policy decision by reading and interpreting the full set of access\ncontrol rules, and based their judgement on the evidence provided by the\nrequesting service.\n\nFIWARE [Authzforce](https://authzforce-ce-fiware.readthedocs.io/) is a service\nwhich is able to provide such an interpretive Policy Decision Point (PDP). It is\nan advanced access control Generic Enabler which is able to interpret rules\nsupplied using the\n[XACML standard](https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=xacml).\nRulesets can be amended and uploaded at any time providing a flexible method to\nmaintain security policies which can change according to business need.\nFurthermore the language used to describe the access policy is designed to be\nhighly extensible and cover any access control scenario.\n\n## What is XACML\n\neXtensible Access Control Markup Language (XACML) is a vendor neutral\ndeclarative access control policy language. It was created to promote common\naccess control terminology and interoperability. The architectural naming\nconventions for elements such as Policy Execution Point (PEP) and Policy\nDecision Point (PDP) come from the XACML specifications.\n\nXACML policies are split into a hierarchy of three levels - `<PolicySet>`,\n`<Policy>` and `<Rule>`, the `<PolicySet>` is a collection of `<Policy>`\nelements each of which contain one or more `<Rule>` elements.\n\nEach `<Rule>` within a `<Policy>` is evaluated as to whether it should grant\naccess to a resource - the overall `<Policy>` result is defined by the overall\nresult of all `<Rule>` elements processed in turn. Separate `<Policy>` results\nare then evaluated against each other using combining alogorthms define which\n`<Policy>` wins in case of conflict.\n\nA `<Rule>` element consists of a `<Target>` and a `<Condition>`. This is an\nexample `<Rule>`, it states access will be granted (`Effect=\"Permit\"`) when a\nPOST request is sent to the `/bell/ring` endpoint, provided that the\n`subject:role` has been provided and that the\n`role=security-role-0000-0000-000000000000` :\n\n```xml\n<Rule RuleId=\"alrmbell-ring-0000-0000-000000000000\" Effect=\"Permit\">\n  <Description>Ring Alarm Bell</Description>\n  <Target>\n    <AnyOf>\n      <AllOf>\n        <Match MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\">\n          <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">/bell/ring</AttributeValue>\n          <AttributeDesignator Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:resource\" AttributeId=\"urn:thales:xacml:2.0:resource:sub-resource-id\" DataType=\"http://www.w3.org/2001/XMLSchema#string\" MustBePresent=\"true\" />\n        </Match>\n      </AllOf>\n    </AnyOf>\n    <AnyOf>\n      <AllOf>\n        <Match MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\">\n          <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">POST</AttributeValue>\n          <AttributeDesignator Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:action\" AttributeId=\"urn:oasis:names:tc:xacml:1.0:action:action-id\" DataType=\"http://www.w3.org/2001/XMLSchema#string\" MustBePresent=\"true\" />\n        </Match>\n      </AllOf>\n    </AnyOf>\n  </Target>\n  <Condition>\n    <Apply FunctionId=\"urn:oasis:names:tc:xacml:3.0:function:any-of\">\n      <Function FunctionId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\" />\n      <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">security-role-0000-0000-000000000000</AttributeValue>\n      <AttributeDesignator Category=\"urn:oasis:names:tc:xacml:1.0:subject-category:access-subject\" AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\" DataType=\"http://www.w3.org/2001/XMLSchema#string\" MustBePresent=\"false\" />\n    </Apply>\n  </Condition>\n</Rule>\n```\n\nThis is a very verbose method for creating a simple Verb-Resource access rule,\nbut unlike simple Verb-Resource rules, with XACML, other more complex\ncomparisons can be made, for example checking that time is before a certain hour\nof day, or checking that a URL starts with or contains a certain string.\nConditions can be specified down to the attribute level or combined to make\ncomplex calculations, for example - an XACML `<Rule>` could be created to apply\nthe following policy:\n\n> _A store manager is able to amend Product prices only the first of the month,\n> and can only alter prices of products she or her immediate superior has\n> created in the first place_\n\nSuch a `<Rule>` would require that the `<Condition>` includes separate\nclauses/clarifications for the following:\n\n-   What is the User's role? (e.g. `manager`)\n-   What action is being invoked? (e.g PATCH or PUT)\n-   Which resource is being protected URL string? (e.g. `/v2/entities`)\n-   What other information must be present in the body of the request? (e.g.\n    Entity `type` must equal `Product`)\n-   When is the resource being requested? (e.g. the current date)\n-   What other additional information must be retrieved from elsewhere prior to\n    making the request\n    -   Who created the entity? Is it me or my manager?\n\nAs you can see these rules can quickly become very complex. For this initial\nintroduction to XACML, the basic rule set used will be kept as simple as\npossible to avoid unnecessary confusion, suffice it to say that an access policy\nbased on XACML can be expanded to fit the security needs of any complex system.\n\n# Prerequisites\n\n## Docker\n\nTo keep things simple all components will be run using\n[Docker](https://www.docker.com). **Docker** is a container technology which\nallows to different components isolated into their respective environments.\n\n-   To install Docker on Windows follow the instructions\n    [here](https://docs.docker.com/docker-for-windows/)\n-   To install Docker on Mac follow the instructions\n    [here](https://docs.docker.com/docker-for-mac/)\n-   To install Docker on Linux follow the instructions\n    [here](https://docs.docker.com/install/)\n\n**Docker Compose** is a tool for defining and running multi-container Docker\napplications. A\n[YAML file](https://raw.githubusercontent.com/Fiware/tutorials.Identity-Management/master/docker-compose.yml)\nis used configure the required services for the application. This means all\ncontainer services can be brought up in a single command. Docker Compose is\ninstalled by default as part of Docker for Windows and Docker for Mac, however\nLinux users will need to follow the instructions found\n[here](https://docs.docker.com/compose/install/)\n\n## Cygwin\n\nWe will start up our services using a simple bash script. Windows users should\ndownload [cygwin](http://www.cygwin.com/) to provide a command-line\nfunctionality similar to a Linux distribution on Windows.\n\n# Architecture\n\nThis application adds level 3 Advanced Authorization security into the existing\nStock Management and Sensors-based application created in\n[previous tutorials](https://github.com/Fiware/tutorials.Securing-Access/) and\nsecures access to the context broker behind a\n[PEP Proxy](https://github.com/Fiware/tutorials.PEP-Proxy/). It will make use of\nfive FIWARE components - the\n[Orion Context Broker](https://fiware-orion.readthedocs.io/en/latest/),the\n[IoT Agent for UltraLight 2.0](https://fiware-iotagent-ul.readthedocs.io/en/latest/),\nthe [Keyrock](https://fiware-idm.readthedocs.io/en/latest/) Identity Manager,\nthe [Wilma]() PEP Proxy and the\n[Authzforce](https://authzforce-ce-fiware.readthedocs.io) XACML Server. All\naccess control decisions will be delegated to **Authzforce** which will read the\nruleset from a previously uploaded policy domain.\n\nBoth the Orion Context Broker and the IoT Agent rely on open source\n[MongoDB](https://www.mongodb.com/) technology to keep persistence of the\ninformation they hold. We will also be using the dummy IoT devices created in\nthe [previous tutorial](https://github.com/Fiware/tutorials.IoT-Sensors/).\n**Keyrock** uses its own [MySQL](https://www.mysql.com/) database.\n\nTherefore the overall architecture will consist of the following elements:\n\n-   The FIWARE\n    [Orion Context Broker](https://fiware-orion.readthedocs.io/en/latest/) which\n    will receive requests using\n    [NGSI](https://fiware.github.io/specifications/OpenAPI/ngsiv2)\n-   The FIWARE\n    [IoT Agent for UltraLight 2.0](https://fiware-iotagent-ul.readthedocs.io/en/latest/)\n    which will receive southbound requests using\n    [NGSI](https://fiware.github.io/specifications/OpenAPI/ngsiv2) and convert\n    them to\n    [UltraLight 2.0](https://fiware-iotagent-ul.readthedocs.io/en/latest/usermanual/index.html#user-programmers-manual)\n    commands for the devices\n-   FIWARE [Keyrock](https://fiware-idm.readthedocs.io/en/latest/) offer a\n    complement Identity Management System including:\n    -   An OAuth2 authentication system for Applications and Users\n    -   A site graphical frontend for Identity Management Administration\n    -   An equivalent REST API for Identity Management via HTTP requests\n-   FIWARE [Authzforce](https://authzforce-ce-fiware.readthedocs.io/) is a XACML\n    Server providing an interpretive Policy Decision Point (PDP) access to the\n    **Orion** and/or **IoT Agent** microservices\n-   FIWARE [Wilma](https://fiware-pep-proxy.rtfd.io/) is a PEP Proxy securing\n    access to the **Orion** microservices, it delegates the passing of\n    authorisation decisions to **Authzforce** PDP\n-   The underlying [MongoDB](https://www.mongodb.com/) database :\n    -   Used by the **Orion Context Broker** to hold context data information\n        such as data entities, subscriptions and registrations\n    -   Used by the **IoT Agent** to hold device information such as device URLs\n        and Keys\n-   A [MySQL](https://www.mysql.com/) database :\n    -   Used to persist user identities, applications, roles and permissions\n-   The **Stock Management Frontend** does the following:\n    -   Displays store information\n    -   Shows which products can be bought at each store\n    -   Allows users to \"buy\" products and reduce the stock count.\n    -   Allows authorized users into restricted areas, it also delegates\n        authoriation decisions to the **Authzforce** PDP\n-   A webserver acting as set of\n    [dummy IoT devices](https://github.com/Fiware/tutorials.IoT-Sensors) using\n    the\n    [UltraLight 2.0](https://fiware-iotagent-ul.readthedocs.io/en/latest/usermanual/index.html#user-programmers-manual)\n    protocol running over HTTP - access to certain resources is restricted.\n\nSince all interactions between the elements are initiated by HTTP requests, the\nentities can be containerized and run from exposed ports.\n\n![](https://fiware.github.io/tutorials.XACML-Access-Rules/img/architecture.png)\n\nThe specific architecture of each section of the tutorial is discussed below.\n\n## Keyrock Configuration\n\n```yaml\nkeyrock:\n    image: fiware/idm\n    container_name: fiware-keyrock\n    hostname: keyrock\n    networks:\n        default:\n            ipv4_address: 172.18.1.5\n    depends_on:\n        - mysql-db\n        - authzforce\n    ports:\n        - \"3005:3005\"\n    environment:\n        - DEBUG=idm:*\n        - DATABASE_HOST=mysql-db\n        - IDM_DB_PASS_FILE=/run/secrets/my_secret_data\n        - IDM_DB_USER=root\n        - IDM_HOST=http://localhost:3005\n        - IDM_PORT=3005\n        - IDM_ADMIN_USER=alice\n        - IDM_ADMIN_EMAIL=alice-the-admin@test.com\n        - IDM_ADMIN_PASS=test\n        - IDM_PDP_LEVEL=advanced\n        - IDM_AUTHZFORCE_ENABLED=true\n        - IDM_AUTHZFORCE_HOST=authzforce\n        - IDM_AUTHZFORCE_PORT=8080\n    secrets:\n        - my_secret_data\n```\n\nThe `keyrock` container is a web application server listening on a single port:\n\n-   Port `3005` has been exposed for HTTP traffic so we can display the web page\n    and interact with the REST API.\n\nThe `keyrock` container is connecting to **Authzforce** and is driven by\nenvironment variables as shown:\n\n| Key                    | Value        | Description                                                                  |\n| ---------------------- | ------------ | ---------------------------------------------------------------------------- |\n| IDM_PDP_LEVEL          | `advanced`   | Flag indicating that **Keyrock** should delegate PDP decisions to Authzforce |\n| IDM_AUTHZFORCE_ENABLED | `true`       | Flag indicating that **Authzforce** is available                             |\n| IDM_AUTHZFORCE_HOST    | `authzforce` | This is URL where the **Authzforce** is found                                |\n| IDM_AUTHZFORCE_PORT    | `8080`       | Port that **Authzforce** is listening on                                     |\n\nThe other `keyrock` container configuration values described in the YAML file\nhave been described in previous tutorials\n\n## PEP Proxy Configuration\n\n```yaml\norion-proxy:\n    image: fiware/pep-proxy\n    container_name: fiware-orion-proxy\n    hostname: orion-proxy\n    networks:\n        default:\n            ipv4_address: 172.18.1.10\n    depends_on:\n        - keyrock\n        - authzforce\n    ports:\n        - \"1027:1027\"\n    expose:\n        - \"1027\"\n    environment:\n        - PEP_PROXY_APP_HOST=orion\n        - PEP_PROXY_APP_PORT=1026\n        - PEP_PROXY_PORT=1027\n        - PEP_PROXY_IDM_HOST=keyrock\n        - PEP_PROXY_HTTPS_ENABLED=false\n        - PEP_PROXY_IDM_SSL_ENABLED=false\n        - PEP_PROXY_IDM_PORT=3005\n        - PEP_PROXY_APP_ID=tutorial-dckr-site-0000-xpresswebapp\n        - PEP_PROXY_USERNAME=pep_proxy_00000000-0000-0000-0000-000000000000\n        - PEP_PASSWORD=test\n        - PEP_PROXY_PDP=authzforce\n        - PEP_PROXY_AUTH_ENABLED=true\n        - PEP_PROXY_MAGIC_KEY=1234\n        - PEP_PROXY_AZF_PROTOCOL=http\n        - PEP_PROXY_AZF_HOST=authzforce\n        - PEP_PROXY_AZF_PORT=8080\n```\n\nThe `orion-proxy` container is an instance of FIWARE **Wilma** listening on port\n`1027`, it is configured to forward traffic to `orion` on port `1026`, which is\nthe default port that the Orion Context Broker is listening to for NGSI\nRequests.\n\nThe `orion-proxy` container is delegating PDP decisions to **Authzforce** and is\ndriven by environment variables as shown:\n\n| Key                    | Value        | Description                                               |\n| ---------------------- | ------------ | --------------------------------------------------------- |\n| PEP_PROXY_PDP          | `authzforce` | Flag ensuring that the PEP Proxy uses Authzforce as a PDP |\n| PEP_PROXY_AZF_PROTOCOL | `http`       | Flag to enable use of the XACML PDP                       |\n| PEP_PROXY_AZF_HOST     | `authzforce` | This is URL where the **Authzforce** is found users       |\n| PEP_PROXY_AZF_PORT     | `8080`       | Port that **Authzforce** is listening on                  |\n\nThe other `orion-proxy` container configuration values described in the YAML\nfile have been described in previous tutorials\n\n## Authzforce Configuration\n\n```yaml\nauthzforce:\n    image: fiware/authzforce-ce-server\n    hostname: authzforce\n    container_name: fiware-authzforce\n    networks:\n        default:\n            ipv4_address: 172.18.1.12\n    ports:\n        - \"8080:8080\"\n    volumes:\n        - ./authzforce/domains:/opt/authzforce-ce-server/data/domains\n```\n\nThe `authzforce` container is listening on port `8080`, where it receives\nrequests to make PDP decisions. A volume has been exposed to upload a\npre-configured domain so that a set of XACML access control policies has already\nbeen supplied.\n\n## Tutorial Security Configuration\n\n```yaml\ntutorial:\n    image: fiware/tutorials.context-provider\n    hostname: iot-sensors\n    container_name: fiware-tutorial\n    networks:\n        default:\n            ipv4_address: 172.18.1.7\n    expose:\n        - \"3000\"\n        - \"3001\"\n    ports:\n        - \"3000:3000\"\n        - \"3001:3001\"\n    environment:\n        - \"DEBUG=tutorial:*\"\n        - \"WEB_APP_PORT=3000\"\n        - \"KEYROCK_URL=http://localhost\"\n        - \"KEYROCK_IP_ADDRESS=http://172.18.1.5\"\n        - \"KEYROCK_PORT=3005\"\n        - \"KEYROCK_CLIENT_ID=tutorial-dckr-site-0000-xpresswebapp\"\n        - \"KEYROCK_CLIENT_SECRET=tutorial-dckr-site-0000-clientsecret\"\n        - \"CALLBACK_URL=http://localhost:3000/login\"\n        - \"AUTHZFORCE_ENABLED=true\"\n        - \"AUTHZFORCE_URL=http://authzforce\"\n        - \"AUTHZFORCE_PORT=8080\"\n```\n\nThe `tutorial` container is listening on two ports:\n\n-   Port `3000` is exposed so we can see the web page displaying the Dummy IoT\n    devices.\n-   Port `3001` is exposed purely for tutorial access - so that cUrl or Postman\n    can make UltraLight commands without being part of the same network.\n\nThe `tutorial` container is now secured by **Authforce**, and is driven by\nenvironment variables as shown:\n\n| Key                | Value               | Description                                         |\n| ------------------ | ------------------- | --------------------------------------------------- |\n| AUTHZFORCE_ENABLED | `true`              | Flag to enable use of the XACML PDP                 |\n| AUTHZFORCE_URL     | `http://authzforce` | This is URL where the **Authzforce** is found users |\n| AUTHZFORCE_PORT    | `8080`              | Port that **Authzforce** is listening on            |\n\nThe other `tutorial` container configuration values described in the YAML file\nhave been described in previous tutorials\n\n# Start Up\n\nTo start the installation, do the following:\n\n```console\ngit clone git@github.com:Fiware/tutorials.XACML-Access-Rules.git\ncd tutorials.XACML-Access-Rules\n\n./services create\n```\n\n> **Note** The initial creation of Docker images can take up to three minutes\n\nThereafter, all services can be initialized from the command-line by running the\n[services](https://github.com/Fiware/tutorials.XACML-Access-Rules/blob/master/services)\nBash script provided within the repository:\n\n```console\n./services start\n```\n\n> :information_source: **Note:** If you want to clean up and start over again\n> you can do so with the following command:\n>\n> ```console\n> ./services stop\n> ```\n\n### Dramatis Personae\n\nThe following people at `test.com` legitimately have accounts within the\nApplication\n\n-   Alice, she will be the Administrator of the **Keyrock** Application\n-   Bob, the Regional Manager of the supermarket chain - he has several store\n    managers under him:\n    -   Manager1\n    -   Manager2\n-   Charlie, the Head of Security of the supermarket chain - he has several\n    store detectives under him:\n    -   Detective1\n    -   Detective2\n\n| Name       | eMail                     | Password |\n| ---------- | ------------------------- | -------- |\n| alice      | alice-the-admin@test.com  | `test`   |\n| bob        | bob-the-manager@test.com  | `test`   |\n| charlie    | charlie-security@test.com | `test`   |\n| manager1   | manager1@test.com         | `test`   |\n| manager2   | manager2@test.com         | `test`   |\n| detective1 | detective1@test.com       | `test`   |\n| detective2 | detective2@test.com       | `test`   |\n\nThe following people at `example.com` have signed up for accounts, but have no\nreason to be granted access\n\n-   Eve - Eve the Eavesdropper\n-   Mallory - Mallory the malicious attacker\n-   Rob - Rob the Robber\n\n| Name    | eMail               | Password |\n| ------- | ------------------- | -------- |\n| eve     | eve@example.com     | `test`   |\n| mallory | mallory@example.com | `test`   |\n| rob     | rob@example.com     | `test`   |\n",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Reading XACML Access Rules",
			"item": [
				{
					"name": "Authzforce - Obtain Version Information",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/xml",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/version",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"version"
							]
						},
						"description": "Once **Authzforce** is running, you can check the status by making an HTTP\nrequest to the exposed administration port (usually `8080`. If the response is\nblank, this is usually because **Authzforce** is not running or is listening on\nanother port.\n\nThe response returns information about the version of Authzforce."
					},
					"response": []
				},
				{
					"name": "List all domains",
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains"
							]
						},
						"description": "To request domain information from **Authzforce**, make a request to the\n`/authzforce-ce/domains` endpoint.\n\nThe response lists the domains which are available in **Authzforce**. This\ncorresponds to the directory structure uploaded to **Authzforce** on start-up."
					},
					"response": []
				},
				{
					"name": "Read a single domain",
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains/{{domain-id}}",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains",
								"{{domain-id}}"
							]
						},
						"description": "To read information about a domain, and to explore further, make a request to\nthe `authzforce-ce/domains/{{domain-id}}` endpoint. The following request\nobtains information about the `gQqnLOnIEeiBFQJCrBIBDA` domain, which has been\ngenerated using using a random key by an external Policy Adminstration Point in\nthis case **Keyrock** has been used as the PAP, and pre-generated the rule sets.\n\nThe response lists more information about the domain, including the id used\nwithin **Keyrock** (`tutorial-dckr-site-0000-xpresswebapp`)"
					},
					"response": []
				},
				{
					"name": "List all PolicySets available within a Domain",
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains/{{domain-id}}/pap/policies",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains",
								"{{domain-id}}",
								"pap",
								"policies"
							]
						},
						"description": "To list the generated ids for all of the PolicySets found within a domain make a\nrequest to the `authzforce-ce/domains/{{domain-id}}/pap/policies` endpoint. The\nfollowing request obtains a list of a given policy ids found within the\n`gQqnLOnIEeiBFQJCrBIBDA` domain.\n\nThe response returns a list of available revisions of the given policy which are\navailable within. the **Authzforce** container. This corresponds the named XML\nfiles `1.xml`, `2.xml` etc."
					},
					"response": []
				},
				{
					"name": "List the available revisions of a PolicySet",
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains/{{domain-id}}/pap/policies/{{policy-id}}",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains",
								"{{domain-id}}",
								"pap",
								"policies",
								"{{policy-id}}"
							]
						},
						"description": "To list the available revisions of a policy, make a request to the\n`authzforce-ce/domains/{{domain-id}}/pap/policies/{{policy-id}}` endpoint.\nAvailable policy id are randomly generated, and can be obtained by drilling down\nusing the previous request. The following request obtains a list revision of a\ngiven policy found within the `gQqnLOnIEeiBFQJCrBIBDA` domain.\n\nThe response returns a list of available revisions of the given policy which are\navailable within the **Authzforce** container. This corresponds the named XML\nfiles `1.xml`, `2.xml` etc."
					},
					"response": []
				},
				{
					"name": "Read a single version of a PolicySet",
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains/{{domain-id}}/pap/policies/{{policy-id}}/2",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains",
								"{{domain-id}}",
								"pap",
								"policies",
								"{{policy-id}}",
								"2"
							]
						},
						"description": "To obtain a single revison of a `<PolicySet>`, make a request to the\n`authzforce-ce/domains/{{domain-id}}/pap/policies/{{policy-id}}/{{revision-number}}`\nendpoint. The following request obtains the second revision of the given policy\nfound within the `gQqnLOnIEeiBFQJCrBIBDA` domain.\n\nThe response contains the full `<PolicySet>` for the given revision. This is a\ncopy of\n[the file](https://github.com/Fiware/tutorials.XACML-Access-Rules/blob/master/authzforce/domains/gQqnLOnIEeiBFQJCrBIBDA/policies/ZjgxOTRhZjUtOGEwNy00ODZhLTk1ODEtYzFmMDVkMDU0ODNj/2.xml)\nheld within **Authzforce**."
					},
					"response": []
				}
			],
			"description": "A single XACML server can be used to administrate access control policies for\nmultiple applications. **Authzforce** is implicitly multi-tenant, in that it\nallows separate organizations to work on their policies in isolation from one\nanother. This is done by separating the security policies for each application\ninto a separate **domain** where they can access their own `<PolicySets>`. A\ndomain holds meta data about the secured application along with versions of the\npolicies themselves (effectively a series of files which can be accessed by a\nfile server). The domain management API can be used to query **Authzforce**\nabout the domains served and policies held.",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "a4c41e34-093d-4739-b5e1-13736c5a803c",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "62d13514-54db-4270-a2c2-beed012e7404",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Requesting Policy Decisions",
			"item": [
				{
					"name": "Permit Access to a Resource",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/xml",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Request xmlns=\"urn:oasis:names:tc:xacml:3.0:core:schema:wd-17\" CombinedDecision=\"false\" ReturnPolicyIdList=\"false\">\n   <Attributes Category=\"urn:oasis:names:tc:xacml:1.0:subject-category:access-subject\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">managers-role-0000-0000-000000000000</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:resource\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:1.0:resource:resource-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">tutorial-dckr-site-0000-xpresswebapp</AttributeValue>\n      </Attribute>\n      <Attribute AttributeId=\"urn:thales:xacml:2.0:resource:sub-resource-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">/app/price-change</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:action\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:1.0:action:action-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">GET</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:environment\" />\n</Request>"
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains/{{domain-id}}/pdp",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains",
								"{{domain-id}}",
								"pdp"
							]
						},
						"description": "To request a decision from Authzforce, make a POST requets to the\n`domains/{domain-id}/pdp` endpoint. In this case the user has the\n`managers-role-0000-0000-000000000000` and is requesting access the the\n`/app/price-change` resource.\n\nThe `managers-role-0000-0000-000000000000` permits access to the\n`/app/price-change` endpoint. The response for a successful request includes a\n`<Decision>` element to `Permit` access to the resource."
					},
					"response": []
				},
				{
					"name": "Deny Access to a Resource",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/xml",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Request xmlns=\"urn:oasis:names:tc:xacml:3.0:core:schema:wd-17\" CombinedDecision=\"false\" ReturnPolicyIdList=\"false\">\n   <Attributes Category=\"urn:oasis:names:tc:xacml:1.0:subject-category:access-subject\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">security-role-0000-0000-000000000000</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:resource\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:1.0:resource:resource-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">tutorial-dckr-site-0000-xpresswebapp</AttributeValue>\n      </Attribute>\n      <Attribute AttributeId=\"urn:thales:xacml:2.0:resource:sub-resource-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">/app/price-change</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:action\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:1.0:action:action-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">GET</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:environment\" />\n</Request>"
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains/{{domain-id}}/pdp",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains",
								"{{domain-id}}",
								"pdp"
							]
						},
						"description": "To request a decision from Authzforce, make a POST requets to the\n`domains/{domain-id}/pdp` endpoint. In this case the user has the\n`security-role-0000-0000-000000000000` and is requesting access the the\n`/app/price-change` resource.\n\nThe `security-role-0000-0000-000000000000` does not permit access to the\n`/app/price-change` endpoint. The response for an unsuccessful request includes\na `<Decision>` element which will `Deny` access to the resource."
					},
					"response": []
				}
			],
			"description": "For the purpose of this tutorial, **Authzforce** has been just been supplied\nwith a simple set of basic role-based rules in a similar fashion to the level 2\nauthorization example found in the previous Securing Access tutorial:\n\n-   The unlock door command can only be sent by **Security** staff.\n-   Access to the price-change and order-stock areas are only available to\n    **Managers**\n-   People with either the **Manager** or **Security** role can ring the bell\n-   Both **Manager** or **Security** can access and interact with the store data\n\nThe only difference is that access to all store entities is now restricted to\nusers with an assigned role rather than being based on level 1 authentication\naccess.\n\nTo request a decision from Authzforce, a structured request containing all\nrelevant information must be sent to the `domains/{domain-id}/pdp` endpoint. In\nthis case, the Body of the request includes information such as the roles that\nthe User has, the application id that is being requested\n(`tutorial-dckr-site-0000-xpresswebapp`) and the HTTP verb and resource that are\nbeing requested ( a GET request on the `/app/price-change` URL). Obviously the\ninformation passed in the Body can be expanded as the rules become more complex.",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "7b40d496-0a0f-424d-a300-d7a4c7946cf7",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "121f1a38-45b2-4245-9fdc-97dfd34c1f5b",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "PDP - Advanced Authorization",
			"item": [
				{
					"name": "Keyrock - User Obtains an Access Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Basic {{Authorization}}",
								"description": "base64 concatenation of Client Id and Client Secret"
							},
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "username=bob-the-manager@test.com&password=test&grant_type=password"
						},
						"url": {
							"raw": "http://{{keyrock}}/oauth2/token",
							"protocol": "http",
							"host": [
								"{{keyrock}}"
							],
							"path": [
								"oauth2",
								"token"
							]
						},
						"description": "In order to identify themselves, every user must obtain an access token, in\norder to do so, they must use one of the OAuth2 access grants described in a\n[previous tutorial](https://github.com/Fiware/tutorials.Securing-Access).\n\nTo log in using the user-credentials flow send a POST request to the\n`oauth2/token` endpoint of **Keyrock** with the `grant_type=password`\n\nThe response returns an `access_token` to identify the user (in this case Bob\nthe Manager)"
					},
					"response": []
				},
				{
					"name": "Keyrock - Obtain Roles and Domain",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"disabled": true
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{keyrock}}/user?access_token={{access-token-bob}}&app_id={{app-id}}&authzforce=true",
							"protocol": "http",
							"host": [
								"{{keyrock}}"
							],
							"path": [
								"user"
							],
							"query": [
								{
									"key": "access_token",
									"value": "{{access-token-bob}}"
								},
								{
									"key": "app_id",
									"value": "{{app-id}}"
								},
								{
									"key": "authzforce",
									"value": "true"
								}
							]
						},
						"description": "If a user has logged in, the `access_token` can be used in combiniation with the `/user` endpoint\nto obtain access permissions to a resouce. This example retrieves Bobs's permissions to a given\nresource.\n\nWhere :\n\n-   `{{access-token}}` is the current access token of a logged in user (e.g.\n    `08fef363c429cb34cfff3f56dfe751a8d1890690`)\n-   `{{app-id}}` holds the application to request\n    `tutorial-dckr-site-0000-xpresswebapp` and `authzforce=true` indicates that\n    we want to obtain an **Authzforce** Domain from **Keyrock**\n\nThe response include an `authorization_decision` attribute which denies direct\naccess for the request, but includes additional information so that an\nadditional request a decision from **Authzforce**\n\nIn the example below the access token used belonged to Bob the manager, and his\nroles and the `app_azf_domain` associated to the `app-id` are returned."
					},
					"response": []
				},
				{
					"name": "Authzforce - Apply a Policy to a Request",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/xml",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Request xmlns=\"urn:oasis:names:tc:xacml:3.0:core:schema:wd-17\" CombinedDecision=\"false\" ReturnPolicyIdList=\"false\">\n   <Attributes Category=\"urn:oasis:names:tc:xacml:1.0:subject-category:access-subject\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">managers-role-0000-0000-000000000000</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:resource\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:1.0:resource:resource-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">tutorial-dckr-site-0000-xpresswebapp</AttributeValue>\n      </Attribute>\n      <Attribute AttributeId=\"urn:thales:xacml:2.0:resource:sub-resource-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">/v2/entities</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:action\">\n      <Attribute AttributeId=\"urn:oasis:names:tc:xacml:1.0:action:action-id\" IncludeInResult=\"false\">\n         <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">POST</AttributeValue>\n      </Attribute>\n   </Attributes>\n   <Attributes Category=\"urn:oasis:names:tc:xacml:3.0:attribute-category:environment\" />\n</Request>"
						},
						"url": {
							"raw": "http://{{authzforce}}/authzforce-ce/domains/{{domain-id}}/pdp",
							"protocol": "http",
							"host": [
								"{{authzforce}}"
							],
							"path": [
								"authzforce-ce",
								"domains",
								"{{domain-id}}",
								"pdp"
							]
						},
						"description": "To request a decision from Authzforce, a structured request containing all\nrelevant information must be sent to the `domains/{domain-id}/pdp` endpoint. In\nthis case, the Body of the request includes information such as the roles that\nthe User has (`managers-role-0000-0000-000000000000`), the application id that\nis being requested (`tutorial-dckr-site-0000-xpresswebapp`) and the HTTP verb\nand resource that are being requested ( a POST request on the `/v2/entities`\nURL)\n\nThe response includes a `<Decision>` element which will either `Permit` or\n`Deny` the request."
					},
					"response": []
				}
			],
			"description": "As a reminder, there are three Levels of PDP Access Control:\n\n-   Level 1: Authentication Access - Allow all actions to every signed in user\n    and no actions to an anonymous user.\n-   Level 2: Basic Authorization - Check which resources and verbs the currently\n    logged in user should have access to\n-   Level 3: Advanced Authorization - Fine grained control through\n    [XACML](https://en.wikipedia.org/wiki/XACML)\n\nWithin FIWARE, Level 3 access control can be provided by adding **Authzforce**\nto the existing security microservices (IDM and PEP Proxy) within the Smart\nApplication infrastructure. Access control levels 1 and 2 have been covered in\n[previous tutorials](https://github.com/Fiware/tutorials.Securing-Access) and\ncan be fulfilled using **Keyrock** alone or with or without an associated PEP\nProxy.\n\nAdvanced Authorization is able to deal with complex rulesets. Permissions are no\nlonger merely based on a fixed role, resource and an action, but can be extended\nas necessary.\n\nFor example users in role `XXX` can access URL **starting with** `YYY` provided\nthat the HTTP verb **is either** `GET`, `PUT` or `POST`. Such users may also\n`DELETE` **provided that** they were the creator in the first place.\n\nWithin the tutorial programatic example we are using our own trusted instance of\n**Keyrock** - once a user has signed in and obtained an `access_token`, the\n`access_token` can be stored in session and used to retrieve user details on\ndemand. All access to the Orion context broker is hidden behind a PEP Proxy.\nWhenever a request is made to Orion, the `access_token` is passed in the header\nof the request, and the PEP proxy handles the decision to whether to execute the\nrequest.",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "d0b2c33c-4bd4-4144-b0c4-6ff68f7c4b51",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "1c0f1529-fe24-44cf-a947-6cc4d9132580",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Advanced Authorization - Sample Code",
			"item": [],
			"description": "Programmatically, any Policy Execution Point consists of two parts, an oAuth\nrequest to Keyrock retrieves information about the user (such as the assigned\nroles) as well as the policy domain to be queried.\n\nA second request is sent to the relevant domain endpoint within Authzforce,\nproviding all of the information necessary for Authzforce to provide a\njudgement. Authzforce responds with a **permit** or **deny** response, and the\ndecision whether to continue can be made thereafter.\n\n```javascript\nfunction authorizeAdvancedXACML(req, res, next, resource = req.url) {\n    const keyrockUserUrl =\n        \"http://keyrock/user?access_token=\" +\n        req.session.access_token +\n        \"&app_id=\" +\n        clientId +\n        \"&authzforce=true\";\n\n    return oa\n        .get(keyrockUserUrl)\n        .then(response => {\n            const user = JSON.parse(response);\n            return azf.policyDomainRequest(\n                user.app_azf_domain,\n                user.roles,\n                resource,\n                req.method\n            );\n        })\n        .then(authzforceResponse => {\n            res.locals.authorized = authzforceResponse === \"Permit\";\n            return next();\n        })\n        .catch(error => {\n            debug(error);\n            res.locals.authorized = false;\n            return next();\n        });\n}\n```\n\nThe full code to supply each request to Authzforce can be found within the\ntutorials'\n[Git Repository](https://github.com/Fiware/tutorials.Step-by-Step/blob/master/context-provider/lib/azf.js) -\nthe actual information to supply will depend on business use case - it could be\nexpanded to include temporal information, relationships between records and so\non, but in this very simple example only roles are necessary.\n\n```javascript\nconst xml2js = require(\"xml2js\");\nconst request = require(\"request\");\n\nfunction policyDomainRequest(domain, roles, resource, action) {\n    let body =\n        '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n' +\n        '<Request xmlns=\"urn:oasis:names:tc:xacml:3.0:core:schema:wd-17\" CombinedDecision=\"false\" ReturnPolicyIdList=\"false\">\\n';\n    // Code to create the XML body for the request is omitted\n    body = body + \"</Request>\";\n\n    const options = {\n        method: \"POST\",\n        url: \"http://authzforceUrl/authzforce-ce/domains/\" + domain + \"/pdp\",\n        headers: { \"Content-Type\": \"application/xml\" },\n        body\n    };\n\n    return new Promise((resolve, reject) => {\n        request(options, function(error, response, body) {\n            let decision;\n            xml2js.parseString(\n                body,\n                { tagNameProcessors: [xml2js.processors.stripPrefix] },\n                function(err, jsonRes) {\n                    // The decision is found within the /Response/Result[0]/Decision[0] XPath\n                    decision = jsonRes.Response.Result[0].Decision[0];\n                }\n            );\n            decision = String(decision);\n            return error ? reject(error) : resolve(decision);\n        });\n    });\n}\n```\n\n### Advanced Authorization - PEP Proxy\n\nApplying advanced authorization within a PEP proxy requires very similar code to\nthe programmatic example described above. The **Wilma** generic enabler extracts\na token from the header supplied by the request and makes a request to\n**Keyrock** to obtain further information about the user. A PDP request is then\nmade to **Authzforce** to decide whether to procede.\n\nObviously any scalable solution should also cache information about the PDP\nrequests made and the responses to avoid making unnecessary requests.\n\n## PDP - Advanced Authorization - Running the Example\n\n> **Note** Five resources have been secured at level 3:\n>\n> -   sending the unlock door command\n> -   sending the ring bell command\n> -   access to the price-change area\n> -   access to the order-stock area\n> -   access to Orion (behind a PEP Proxy)\n\n#### Eve the Eavesdropper\n\nEve has an account, but no roles in the application.\n\n> **Note** As Eve has a recognized account, she gains full authentication\n> access. This means she is able to _view_ the Store page, even though her\n> account has no roles attached.\n\n-   From `http://localhost:3000`, log in as `eve@example.com` with the password\n    `test`\n\n##### Level 3 : Advanced Authorization Access\n\n-   Click on any store page - access to view the page is **permitted** for any\n    logged in users, however access to retrieve Orion data is now **denied**\n    since Eve has no role which permits access.\n\n-   Click on the restricted access links at `http://localhost:3000` - access is\n    **denied**\n-   Open the Device Monitor on `http://localhost:3000/device/monitor`\n    -   Unlock a door - access is **denied**\n    -   Ring a bell - access is **denied**\n\n#### Bob The Regional Manager\n\nBob has the **management** role\n\n-   From `http://localhost:3000`, log in as `bob-the-manager@test.com` with the\n    password `test`\n\n##### Level 3 : Advanced Authorization Access\n\n-   Click on the restricted access links at `http://localhost:3000` - access is\n    **permitted** - This is a management only permission\n-   Open the Device Monitor on `http://localhost:3000/device/monitor`\n    -   Unlock a door - access is **denied**. - This is a security only\n        permission\n    -   Ring a bell - access is **permitted** - This is permitted to management\n        users\n\n#### Charlie the Security Manager\n\nCharlie has the **security** role\n\n-   From `http://localhost:3000`, log in as `charlie-security@test.com` with the\n    password `test`\n\n##### Level 3: Advanced Authorization Access\n\n-   Click on the restricted access links at `http://localhost:3000` - access is\n    **denied** - This is a management only permission\n-   Open the Device Monitor on `http://localhost:3000/device/monitor`\n    -   Unlock a door - access is **permitted** - This is a security only\n        permission\n    -   Ring a bell - access is **permitted** - This is permitted to security\n        users"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "bf821021-7bc2-471e-9ab7-a55ecb9e663f",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "1269e342-1093-4844-83cb-f8fed192c512",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "a4fd4d74-91c2-40c8-90db-dd2105f84229",
			"key": "authzforce",
			"value": "localhost:8080",
			"type": "string"
		},
		{
			"id": "db7a18f9-a324-4891-abb0-f6c3dbee9d25",
			"key": "keyrock",
			"value": "localhost:3005",
			"type": "string"
		},
		{
			"id": "2123a7a0-b227-4aca-b995-743f03cd9042",
			"key": "domain-id",
			"value": "gQqnLOnIEeiBFQJCrBIBDA",
			"type": "string"
		},
		{
			"id": "5ee42927-62ef-4f24-88fb-a504e5113abf",
			"key": "policy-id",
			"value": "f8194af5-8a07-486a-9581-c1f05d05483c",
			"type": "string"
		},
		{
			"id": "1741a020-4e63-4e42-b2b2-febf5a2d8fbb",
			"key": "Authorization",
			"value": "dHV0b3JpYWwtZGNrci1zaXRlLTAwMDAteHByZXNzd2ViYXBwOnR1dG9yaWFsLWRja3Itc2l0ZS0wMDAwLWNsaWVudHNlY3JldA==",
			"type": "string"
		},
		{
			"id": "ff8fdcb9-68d2-46da-84fd-ef9a63d13827",
			"key": "access-token-bob",
			"value": "1b88827586409b3b4dc67378e6b945c99b94c6cf",
			"type": "string"
		},
		{
			"id": "366811f5-3689-417b-ba2a-463bcfb2f7c5",
			"key": "app-id",
			"value": "tutorial-dckr-site-0000-xpresswebapp",
			"type": "string"
		}
	]
}